# 會議記錄優化系統 - 專案資訊流程與模型應用說明

## 專案概述

本系統是一個**基於提示詞工程的會議記錄自動化優化平台**，透過多模型協作和疊代優化機制，將會議逐字稿轉換為高品質的結構化會議記錄。系統採用**分層模型應用架構**和**閉環優化策略**，達到持續改進的智能化會議記錄生成。

## 核心設計理念

### 🎯 模型分工策略
- **生成模型（Main Generator）**：負責會議記錄核心內容生成
- **優化模型（Strategy Optimizer）**：擔任「提示詞工程師」角色，分析品質並優化策略
- **評估模型（Evaluator）**：多指標評分與品質檢測
- **語意模型（Semantic Processor）**：語意分段與內容結構化

### 🔄 疊代優化機制
透過AI-AI協作模式，實現從低品質到高品質的漸進式改進，每一輪疊代都基於前一輪的評估結果進行策略調整。

---

## 🏗️ 系統架構與資訊流向

### 第一層：資料輸入與預處理
```
原始逐字稿 (data/transcript/) 
    ↓
智能文本預處理
    ↓
語意分段檢查 (>4000字元時自動啟用)
    ↓
[gemma3:12b] 語意分段處理
    ↓
品質檢查與驗證
    ↓
分段優化或回退機制
```

### 第二層：參考標準配對
```
標準會議記錄庫 (data/reference/)
    ↓
自動配對演算法
    ↓
找到匹配 → 使用標準參考
找不到 → 使用逐字稿自身
    ↓
評估基準確立
```

### 第三層：策略與提示詞管理
```
30種優化策略庫 (config/improvement_strategies.json)
    ↓
多維度策略分類：
├── 角色定義強化 (A1-A5)
├── 結構格式優化 (B1-B5) 
├── 內容深度增強 (C1-C5)
├── 格式約束精確化 (D1-D5)
├── 語言風格調整 (E1-E5)
└── 品質控制機制 (F1-F5)
    ↓
衝突檢測與兼容性分析
    ↓
智能策略組合生成
```

### 第四層：核心優化循環

#### 🔄 疊代循環架構
```
第N輪疊代開始
    ↓
[cwchang/llama3-taide-lx-8b-chat-alpha1] 
載入 + 會議記錄生成
    ↓
模型卸載 + 記憶體釋放
    ↓
[多指標評估引擎] 
BERTScore + ROUGE + 結構分析
    ↓
[gemma3:12b] 載入 + 策略分析
分析評分 → 生成改進建議 → 策略組合優化
    ↓
模型卸載 + 記憶體釋放
    ↓
Early Stopping 檢查
    ↓
品質達標 or 最大疊代 → 結束
品質未達標 → 第N+1輪疊代
```

#### 📊 品質評估多指標體系
- **語義相似度 (BERTScore F1)**：衡量生成內容與參考標準的語義匹配度
- **內容覆蓋度 (ROUGE-1/2/L)**：評估關鍵信息的覆蓋完整性
- **結構品質 (Structure Quality)**：分析會議記錄的格式規範和組織架構
- **TaiwanScore**：本地化內容適應性評分
- **行動項目明確性**：決議執行要素的具體程度
- **格式一致性**：文檔標準化程度

---

## 🤖 模型應用詳細說明

### 主要生成模型：cwchang/llama3-taide-lx-8b-chat-alpha1:latest
**角色：** 會議記錄內容生成專家
**規格：** 8B參數，4-bit量化，約5.7GB記憶體佔用
**功能：**
- 逐字稿理解與結構化轉換
- 會議要點提取與歸納整理
- 決議事項明確化表達
- 參與者發言歸屬與整理

### 策略優化模型：gemma3:12b  
**角色：** 提示詞工程師與優化策略分析師
**規格：** 12B參數，4-bit量化，約8.1GB記憶體佔用
**功能：**
- 會議記錄品質分析與診斷
- 基於評分結果的改進策略建議
- 提示詞動態優化與調整
- 策略組合兼容性分析

### 語意分段模型：gemma3:12b
**角色：** 大型文本智能分段處理器
**規格：** 12B參數，約8.1GB記憶體佔用
**功能：**
- 長篇逐字稿的語意完整性分段
- AI驅動的智能邊界檢測與優化
- 分段邊界語意連貫性檢查
- 內容完整性與覆蓋度驗證
- 多維度品質評估（語意完整性、主題一致性、邏輯連貫性）
- 品質不佳時的自動回退機制

### 嵌入式模型：nomic-embed-text:latest
**角色：** 語義向量計算與相似度評估
**規格：** 約274MB記憶體佔用
**功能：**
- 文本語義向量編碼
- BERTScore計算支援
- 語義相似度量化評估

---

## 📈 資訊流向與決策點

### 流程決策樹
```
輸入逐字稿
    ↓
文本長度檢查
    ├── <4000字元 → 直接處理
    └── ≥4000字元 → 語意分段流程
            ↓
        語意分段處理
            ├── 品質檢查通過 → 使用分段結果
            └── 品質檢查失敗 → 回退簡單分段
    ↓
策略選擇
    ├── 第1輪 → 基礎策略組合
    └── 第N輪 → AI建議策略組合
    ↓
會議記錄生成
    ↓
多指標評估
    ↓
達到終止條件？
    ├── 是 → 輸出最佳結果
    └── 否 → 策略優化 → 下一輪疊代
```

### AI決策支援點
1. **語意分段決策**：基於內容複雜度和長度的自動分段策略選擇
2. **策略組合決策**：根據歷史表現和當前評分的動態策略調整
3. **品質閾值決策**：多指標權重平衡的品質達標判斷
4. **早停機制決策**：基於改進趨勢的疊代終止時機判斷

---

## 🔧 技術架構特點

### 記憶體安全管理
- **分時段模型載入**：確保任何時刻只有一個大模型在記憶體中
- **智能模型切換**：載入前強制卸載，等待記憶體完全釋放
- **峰值控制**：記憶體使用峰值不超過10.1GB

### 模型生命週期管理
```
Ollama服務按需啟動
    ↓
模型預載與檢查
    ↓
執行階段：模型載入 → 推理 → 立即卸載
    ↓
記憶體監控與清理
    ↓
服務關閉與資源回收
```

### 容錯與回退機制
- **語意分段回退**：品質不佳時自動回退到簡單分段
- **模型切換失敗處理**：記憶體不足時的自動清理機制
- **評估異常處理**：評估失敗時的預設分數機制
- **策略衝突處理**：不兼容策略的自動排除與替換

---

## 📊 系統效能指標

### 最佳品質表現
- **整體最佳分數**：0.5529（第671次市政會議）
- **語義相似度峰值**：0.6771
- **結構品質峰值**：0.8500
- **最佳策略**：明確標註發言者策略

### 處理能力
- **文本處理上限**：單檔11,295字元（實測通過）
- **疊代效率**：平均5-10輪達到最佳效果
- **策略覆蓋度**：30種策略×多維度組合
- **語意分段精度**：品質評分≥8分視為優質分段

---

## 🚀 系統使用方式

### 快速啟動
```bash
# 1. 環境準備
source .venv/bin/activate
pip install -r requirements.txt

# 2. 模型檢查
ollama pull cwchang/llama3-taide-lx-8b-chat-alpha1:latest
ollama pull gemma3:12b

# 3. 數據準備
# 將逐字稿放入 data/transcript/
# 將參考記錄放入 data/reference/

# 4. 執行優化
./run_optimization.sh --model cwchang/llama3-taide-lx-8b-chat-alpha1:latest
```

### 進階配置
```bash
# 自定義參數執行
./run_optimization.sh \
  --max-iterations 10 \
  --quality-threshold 0.85 \
  --optimization-model gemma3:12b \
  --enable-semantic-segmentation
```

---

## 📁 結果產出

### 檔案輸出結構
```
results/
├── optimized/                     # 最佳化會議記錄
│   └── {會議名稱}_best.md
├── scores/                        # 評分報告
│   └── {會議名稱}_scores.json
├── optimization_history/          # 優化歷史
│   └── {會議名稱}_history.json
└── segment_reports/               # 語意分段報告
    └── {會議名稱}_segment_eval.json

logs/
├── optimization_{timestamp}.log   # 主要優化日誌
├── memory_usage_{timestamp}.log   # 記憶體使用記錄
└── model_switching_{timestamp}.log # 模型切換日誌
```

### 品質報告內容
- **疊代表現趨勢**：各輪評分變化曲線
- **策略效果分析**：各策略組合的效果對比
- **模型切換記錄**：載入/卸載時間與記憶體使用
- **語意分段品質**：分段邊界與連貫性評估

---

## 🔮 系統擴展性

### 模型擴展
- 支援新增不同規模的Ollama模型
- 可配置模型角色與專業化分工
- 支援多語言模型混合使用

### 策略擴展
- 30種基礎策略可任意擴充
- 支援自定義維度與衝突規則
- 可匯入外部策略庫

### 評估擴展
- 可新增自定義評估指標
- 支援權重調整與多指標優化
- 可整合外部評估API

### 應用擴展
- 可適用於不同類型會議（政府、企業、學術）
- 支援批次處理與自動化流程
- 可整合到現有會議管理系統

---

這個系統代表了**提示詞工程**、**多模型協作**和**疊代優化**在實際應用中的最佳實踐，透過精心設計的資訊流向和AI決策點，實現了從原始逐字稿到高品質會議記錄的全自動化轉換。
